
import pandas as pd

attack_surface_df = pd.read_csv('../data/condensed_attack_surface.csv')
demographics_df = pd.read_csv('../data/state_county_demographics.csv')

median_income_arr = []
percent_hs_arr = []
percent_bachelors_arr = []
percent_white_arr = []
total_population_arr = []

for index, row in attack_surface_df.iterrows():
    search_result = demographics_df[(demographics_df['state'] == row['state']) & (demographics_df['county'] == row['county'])]
    if len(search_result) == 1:
        median_income_arr.append(search_result.iloc[0]['median_income'])
        percent_hs_arr.append(search_result.iloc[0]['percent_hs'])
        percent_bachelors_arr.append(search_result.iloc[0]['percent_bachelors'])
        percent_white_arr.append(search_result.iloc[0]['percent_white'])
        total_population_arr.append(search_result.iloc[0]['total_population'])
    else:
        median_income_arr.append(-1)
        percent_hs_arr.append(-1)
        percent_bachelors_arr.append(-1)
        percent_white_arr.append(-1)
        total_population_arr.append(-1)

attack_surface_df['median_income'] = median_income_arr
attack_surface_df['percent_hs'] = percent_hs_arr
attack_surface_df['percent_bachelors'] = percent_bachelors_arr
attack_surface_df['percent_white'] = percent_white_arr
attack_surface_df['total_population'] = total_population_arr

cols = ['state', 'county', 'domain', 'ipaddress', 'tier', 'median_income', 'percent_hs', 'percent_bachelors', 'percent_white', 'total_population']
attack_surface_df.to_csv('../data/final_combined.csv', columns=cols)
