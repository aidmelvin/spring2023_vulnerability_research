
from typing import List
from models.County import County
from data.state_codes import state_to_code
import pandas as pd
from threading import Thread


class State:
    def __init__(self, state_name: str):
        self.state_code = state_to_code[state_name]
        self.state_name = state_name

        # read in from CSV files
        self.counties: List[County] = []

        df = pd.read_csv(f"data/{self.state_name.lower()}_counties.csv", dtype=str)

        for index, row in df.iterrows():
            self.counties.append(County(row['county_name'], row['county_code'], row['state_name'], row['state_code']))

    def get_county_data(self):
        tasks = []
        for county in self.counties:
            tasks.append(Thread(target=county.fetch_all_self_data))
            tasks[len(tasks) - 1].start()
            # county.fetch_all_self_data()
            # county.get_income_levels()
            # county.get_education_levels()
            # county.get_race_percentages()
        for task in tasks:
            task.join()
