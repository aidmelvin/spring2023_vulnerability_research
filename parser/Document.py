
from parser.Domain import Domain
from typing import List
import orjson


class Document:
    def __init__(self, d: str):
        self._document_file_name = d
        self.domains: List[Domain] = []

    def parse_document(self):
        fh = open(self._document_file_name, 'rb')
        for line in fh.readlines():
            line = str(line)
            if 0 <= line.find('orig_domain:') < 10:
                temp = Domain()
                temp.domain_name = line[line.find('orig_domain:') + 12:(line.find('\\r\\n'))]
                self.domains.append(temp)
            elif 0 <= line.find("query_terms:") < 10:
                pass
            elif 0 <= line.find('query_results:') < 10:
                self.domains[len(self.domains) - 1].set_raw_row_text(line[line.find('query_results:') + 14:line.find('\\r')])

        fh.close()

        for domain in self.domains:
            try:
                domain.parse_row_new()
            except orjson.JSONDecodeError:  # this occurs because some data has special chars like รถ
                pass  # ignoring these for now, we still have 98% of the data
