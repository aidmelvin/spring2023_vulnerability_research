
from typing import List, Dict
import hjson


class Domain:
    def __init__(self, raw_row_text: str):
        self.raw_row_text: str = raw_row_text
        self.domain_name: str = ''
        # self.ip_count: int = -1
        self.ips: List[str] = []
        self.ports: List[int] = []
        self.services: List[str] = []
        self.port_tier_data: Dict[int, List[int]] = {}
        self.overall_port_tier: int = -1
        self.parse_row()

    def parse_row(self):
        all_aspects = self.raw_row_text.split('""')
        for i in range(0, len(all_aspects)):
            all_aspects[i] = all_aspects[i].strip().replace('"', '')

        i = 0
        while i < len(all_aspects):
            if all_aspects[i] == '' or all_aspects[i].find(',,') != -1:
                all_aspects.pop(i)
            else:
                i = i + 1
        self.domain_name = all_aspects[0]
        self.ips = all_aspects[1].split(',')
        self.ports = [int(i) for i in all_aspects[3].split(',')]
        self.services = all_aspects[5].split(',')
        self.port_tier_data = hjson.loads(all_aspects[7])
        self.overall_port_tier = int(all_aspects[len(all_aspects) - 1])
